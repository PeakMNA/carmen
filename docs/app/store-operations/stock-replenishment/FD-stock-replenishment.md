# Flow Diagrams: Stock Replenishment Module

## 1. High-Level System Flow

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                     Stock Replenishment System Overview                         │
└─────────────────────────────────────────────────────────────────────────────────┘

     ┌──────────────┐
     │  PAR Level   │
     │  Monitoring  │
     └──────┬───────┘
            │
            ▼
     ┌──────────────┐      ┌──────────────┐
     │   Items      │      │   Stock      │
     │ Below PAR    │◄────►│  Balances    │
     └──────┬───────┘      └──────────────┘
            │
            ▼
     ┌──────────────┐
     │  Urgency     │
     │Classification│
     └──────┬───────┘
            │
            ├─────────────────────────────────────┐
            │                                     │
            ▼                                     ▼
     ┌──────────────┐                      ┌──────────────┐
     │   Source     │                      │   Manual     │
     │  Available?  │                      │  Selection   │
     └──────┬───────┘                      └──────┬───────┘
            │                                     │
     ┌──────┴──────┐                              │
     │             │                              │
     ▼             ▼                              │
  ┌─────┐     ┌─────┐                             │
  │ YES │     │ NO  │                             │
  └──┬──┘     └──┬──┘                             │
     │           │                                │
     ▼           ▼                                │
┌─────────┐ ┌─────────┐                           │
│ Stock   │ │PR-Only  │                           │
│Transfer │ │Workflow │◄──────────────────────────┘
└────┬────┘ └────┬────┘
     │           │
     └─────┬─────┘
           │
           ▼
    ┌──────────────┐
    │    Store     │
    │ Requisition  │
    └──────┬───────┘
           │
           ▼
    ┌──────────────┐
    │   Approval   │
    │   Workflow   │
    └──────┬───────┘
           │
     ┌─────┴─────┐
     │           │
     ▼           ▼
┌─────────┐ ┌─────────┐ ┌─────────┐
│   ST    │ │   SI    │ │   PR    │
│Generated│ │Generated│ │Generated│
└─────────┘ └─────────┘ └─────────┘
```

## 2. Urgency Classification Flow

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                         Urgency Classification Logic                            │
└─────────────────────────────────────────────────────────────────────────────────┘

                    ┌───────────────────┐
                    │   For Each Item   │
                    │   at Location     │
                    └─────────┬─────────┘
                              │
                              ▼
                    ┌───────────────────┐
                    │  currentStock     │
                    │  ÷ parLevel       │
                    │  × 100 = %        │
                    └─────────┬─────────┘
                              │
              ┌───────────────┼───────────────┐
              │               │               │
              ▼               ▼               ▼
        ┌─────────┐     ┌─────────┐     ┌─────────┐
        │  < 30%  │     │ 30-60%  │     │  > 60%  │
        └────┬────┘     └────┬────┘     └────┬────┘
             │               │               │
             ▼               ▼               ▼
        ┌─────────┐     ┌─────────┐     ┌─────────┐
        │CRITICAL │     │ WARNING │     │   LOW   │
        │   🔴    │     │   🟡    │     │   🔵    │
        └─────────┘     └─────────┘     └─────────┘
             │               │               │
             │               │               │
             ▼               ▼               ▼
     ┌──────────────────────────────────────────────┐
     │           Dashboard Display                  │
     │  ┌────────┐ ┌────────┐ ┌────────┐           │
     │  │Critical│ │Warning │ │  Low   │           │
     │  │   12   │ │   25   │ │   8    │           │
     │  └────────┘ └────────┘ └────────┘           │
     └──────────────────────────────────────────────┘
```

## 3. Replenishment Request Creation Flow

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                    Replenishment Request Creation                               │
└─────────────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────┐
│                        DASHBOARD                                  │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │ [Filter: All ▼] [Location: All ▼]                           │ │
│  ├─────────────────────────────────────────────────────────────┤ │
│  │ □ Product A  | Main Kitchen | Critical | 5/50              │ │
│  │ ☑ Product B  | Main Kitchen | Warning  | 25/50             │ │
│  │ ☑ Product C  | Pool Bar     | Critical | 3/30              │ │
│  │ □ Product D  | Pool Bar     | Low      | 40/50             │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                   │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │ 🛒 2 items selected         [Create Request]                │ │
│  └─────────────────────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────────────────────┘
                              │
                              │ Click "Create Request"
                              ▼
┌──────────────────────────────────────────────────────────────────┐
│                     NEW REQUEST FORM                              │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │ Source Location: [Central Store ▼] [None - PR Only]         │ │
│  │ Priority:        [Standard ▼] [Urgent] [Emergency]          │ │
│  │ Required Date:   [2024-01-15]                               │ │
│  ├─────────────────────────────────────────────────────────────┤ │
│  │ Items:                                                      │ │
│  │ ┌─────────────────────────────────────────────────────────┐ │ │
│  │ │ Product B | Req: 25 | Avail: 200 | ✓ Valid              │ │ │
│  │ │ Product C | Req: 27 | Avail: 150 | ✓ Valid              │ │ │
│  │ └─────────────────────────────────────────────────────────┘ │ │
│  │                                                             │ │
│  │ [Cancel]                            [Submit Request]        │ │
│  └─────────────────────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────────────────────┘
                              │
                              │ Submit
                              ▼
                    ┌───────────────────┐
                    │ Create Store      │
                    │ Requisition       │
                    └─────────┬─────────┘
                              │
                              ▼
                    ┌───────────────────┐
                    │ Redirect to       │
                    │ SR Module         │
                    └───────────────────┘
```

## 4. Workflow Type Determination Flow

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                      Workflow Type Determination                                │
└─────────────────────────────────────────────────────────────────────────────────┘

                    ┌───────────────────┐
                    │  Source Location  │
                    │    Selection      │
                    └─────────┬─────────┘
                              │
                              ▼
                    ┌───────────────────┐
                    │ Source = "none"?  │
                    └─────────┬─────────┘
                              │
              ┌───────────────┴───────────────┐
              │                               │
              ▼                               ▼
         ┌────────┐                      ┌────────┐
         │  YES   │                      │   NO   │
         └────┬───┘                      └────┬───┘
              │                               │
              ▼                               ▼
     ┌─────────────────┐            ┌───────────────────┐
     │   PR-ONLY       │            │ Check Destination │
     │   Workflow      │            │   Location Type   │
     │   ─────────     │            └─────────┬─────────┘
     │ All items go    │                      │
     │ to Purchase     │          ┌───────────┴───────────┐
     │ Request (PR)    │          │                       │
     └─────────────────┘          ▼                       ▼
                           ┌─────────────┐         ┌─────────────┐
                           │   DIRECT    │         │  INVENTORY  │
                           │   Type      │         │  Type       │
                           └──────┬──────┘         └──────┬──────┘
                                  │                       │
                                  ▼                       ▼
                           ┌─────────────┐         ┌─────────────┐
                           │ STOCK ISSUE │         │   STOCK     │
                           │     (SI)    │         │  TRANSFER   │
                           │ ─────────── │         │    (ST)     │
                           │ Issue to    │         │ ─────────── │
                           │ expense     │         │ INVENTORY   │
                           │ location    │         │ to INVENTORY│
                           └─────────────┘         └─────────────┘
```

## 5. Source Availability Check Flow

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                       Source Availability Check                                 │
└─────────────────────────────────────────────────────────────────────────────────┘

              ┌───────────────────┐
              │ Get Source        │
              │ Location Stock    │
              └─────────┬─────────┘
                        │
                        ▼
              ┌───────────────────┐
              │ For Each          │
              │ Requested Item    │
              └─────────┬─────────┘
                        │
            ┌───────────┴───────────┐
            │                       │
            ▼                       ▼
    ┌───────────────┐       ┌───────────────┐
    │ Source Stock  │       │ Source Stock  │
    │ >= Requested  │       │ <  Requested  │
    └───────┬───────┘       └───────┬───────┘
            │                       │
            ▼                       ▼
    ┌───────────────┐       ┌───────────────┐
    │    ✓ Valid    │       │   Partial     │
    │               │       │   Fulfillment │
    │ Full quantity │       ├───────────────┤
    │ from stock    │       │ Available →ST │
    │               │       │ Shortfall →PR │
    └───────────────┘       └───────────────┘
            │                       │
            └───────────┬───────────┘
                        │
                        ▼
              ┌───────────────────┐
              │ Display Item      │
              │ Status in Form    │
              │ ─────────────     │
              │ Product A ✓       │
              │ Product B ⚠       │
              │   (5 to PR)       │
              └───────────────────┘
```

## 6. Document Generation Flow

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                         Document Generation Flow                                │
└─────────────────────────────────────────────────────────────────────────────────┘

                    ┌───────────────────┐
                    │ Store Requisition │
                    │    APPROVED       │
                    └─────────┬─────────┘
                              │
                              ▼
                    ┌───────────────────┐
                    │ Analyze Line      │
                    │ Items             │
                    └─────────┬─────────┘
                              │
         ┌────────────────────┼────────────────────┐
         │                    │                    │
         ▼                    ▼                    ▼
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│ Items with      │  │ Items to        │  │ Items with      │
│ Source Stock    │  │ DIRECT          │  │ No Source       │
│ to INVENTORY    │  │ Location        │  │ (Shortfall)     │
└────────┬────────┘  └────────┬────────┘  └────────┬────────┘
         │                    │                    │
         ▼                    ▼                    ▼
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│ Generate        │  │ Generate        │  │ Generate        │
│ STOCK TRANSFER  │  │ STOCK ISSUE     │  │ PURCHASE        │
│ (ST)            │  │ (SI)            │  │ REQUEST (PR)    │
├─────────────────┤  ├─────────────────┤  ├─────────────────┤
│ ST-2401-0001    │  │ SI-2401-0001    │  │ PR-2401-0001    │
│ From: Central   │  │ From: Central   │  │ Deliver To:     │
│ To: Main Kitchen│  │ To: Bar Direct  │  │ Main Kitchen    │
│ Items: 3        │  │ Items: 2        │  │ Items: 1        │
│ Value: $500     │  │ Value: $200     │  │ Est: $150       │
└─────────────────┘  └─────────────────┘  └─────────────────┘
         │                    │                    │
         └────────────────────┼────────────────────┘
                              │
                              ▼
                    ┌───────────────────┐
                    │ Update SR Status  │
                    │ → PROCESSING      │
                    └─────────┬─────────┘
                              │
                              ▼
                    ┌───────────────────┐
                    │ Link Generated    │
                    │ Documents to SR   │
                    └───────────────────┘
```

## 7. Location Type Validation Flow

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                      Location Type Validation                                   │
└─────────────────────────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────────────────────┐
│                         Source Location Validation                             │
├───────────────────────────────────────────────────────────────────────────────┤
│                                                                                │
│    Location Type        Can Be Source?       Reason                           │
│    ─────────────        ──────────────       ──────                           │
│    INVENTORY            ✓ YES                Has stock balance to transfer    │
│    DIRECT               ✗ NO                 No inventory exists              │
│    CONSIGNMENT          ✓ YES (with warning) Requires vendor notification     │
│    "none"               ✓ SPECIAL            PR-only workflow                 │
│                                                                                │
└───────────────────────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────────────────────┐
│                       Destination Location Validation                          │
├───────────────────────────────────────────────────────────────────────────────┤
│                                                                                │
│    Location Type        Can Receive?         Reason                           │
│    ─────────────        ────────────         ──────                           │
│    INVENTORY            ✓ YES                Has PAR levels, tracks stock     │
│    DIRECT               ✗ NO                 No PAR levels, immediate expense │
│    CONSIGNMENT          ✓ YES                Has PAR levels                   │
│                                                                                │
└───────────────────────────────────────────────────────────────────────────────┘

                    Validation Flow:
                    
                    ┌───────────────────┐
                    │ User Selects      │
                    │ Destination       │
                    └─────────┬─────────┘
                              │
                              ▼
                    ┌───────────────────┐
                    │ Check Location    │
                    │ Type              │
                    └─────────┬─────────┘
                              │
              ┌───────────────┴───────────────┐
              │                               │
              ▼                               ▼
        ┌─────────┐                     ┌─────────┐
        │ DIRECT  │                     │ Other   │
        └────┬────┘                     └────┬────┘
             │                               │
             ▼                               ▼
    ┌─────────────────┐             ┌─────────────────┐
    │ ❌ BLOCKED      │             │ ✓ ALLOWED       │
    │                 │             │                 │
    │ "Cannot         │             │ Proceed with    │
    │  replenish      │             │ source          │
    │  DIRECT         │             │ selection       │
    │  locations"     │             │                 │
    └─────────────────┘             └─────────────────┘
```

## 8. User Journey Flow

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           User Journey Flow                                     │
└─────────────────────────────────────────────────────────────────────────────────┘

    ┌─────────┐      ┌─────────┐      ┌─────────┐      ┌─────────┐      ┌─────────┐
    │ DISCOVER│ ───► │ FILTER  │ ───► │ SELECT  │ ───► │CONFIGURE│ ───► │ SUBMIT  │
    └─────────┘      └─────────┘      └─────────┘      └─────────┘      └─────────┘
         │               │                │                │                │
         │               │                │                │                │
         ▼               ▼                ▼                ▼                ▼
    ┌─────────────────────────────────────────────────────────────────────────────┐
    │                                                                             │
    │  View          Filter by        Select items      Choose source    Submit   │
    │  Dashboard     urgency &        via checkbox      location &       request  │
    │  with items    location         selection         set priority              │
    │  below PAR                                                                  │
    │                                                                             │
    │  👁️             🔍               ☑️                ⚙️              ✅        │
    │                                                                             │
    └─────────────────────────────────────────────────────────────────────────────┘
         │               │                │                │                │
         │               │                │                │                │
         ▼               ▼                ▼                ▼                ▼
    ┌─────────┐    ┌─────────┐      ┌─────────┐      ┌─────────┐      ┌─────────┐
    │ Summary │    │ Filtered│      │ Floating│      │ Request │      │ SR      │
    │ Cards   │    │ Item    │      │ Action  │      │ Form    │      │ Created │
    │         │    │ List    │      │ Bar     │      │         │      │         │
    └─────────┘    └─────────┘      └─────────┘      └─────────┘      └─────────┘
    
    ──────────────────────────────────────────────────────────────────────────────►
                                    Time Flow
```

## 9. State Transition Diagram

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                    Store Requisition State Transitions                          │
└─────────────────────────────────────────────────────────────────────────────────┘

                              ┌──────────────┐
                              │    DRAFT     │
                              └──────┬───────┘
                                     │ submit
                                     ▼
                              ┌──────────────┐
                     ┌────────│  SUBMITTED   │────────┐
                     │        └──────┬───────┘        │
                     │ reject        │ approve        │ cancel
                     ▼               ▼                ▼
              ┌──────────────┐ ┌──────────────┐ ┌──────────────┐
              │   REJECTED   │ │   APPROVED   │ │  CANCELLED   │
              └──────────────┘ └──────┬───────┘ └──────────────┘
                                     │ process
                                     ▼
                              ┌──────────────┐
                              │  PROCESSING  │
                              └──────┬───────┘
                                     │
              ┌──────────────────────┼──────────────────────┐
              │                      │                      │
              ▼                      ▼                      ▼
       ┌──────────────┐       ┌──────────────┐       ┌──────────────┐
       │   PARTIAL    │       │   PROCESSED  │       │  CANCELLED   │
       │   COMPLETE   │       └──────┬───────┘       └──────────────┘
       └──────┬───────┘              │
              │                      │
              └──────────┬───────────┘
                         │ all docs complete
                         ▼
                  ┌──────────────┐
                  │  COMPLETED   │
                  └──────────────┘
```
